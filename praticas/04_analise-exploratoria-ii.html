<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Flávia da Fonseca Feitosa">
<meta name="author" content="Beatriz Milz">

<title>4&nbsp; Análise exploratória de dados - Parte 2 – Análise de dados para o Planejamento Territorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../praticas/05_intervalo-de-confianca.html" rel="next">
<link href="../praticas/03_analise-exploratoria.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5fd9db47a040b21ac2cac9a0b3b722ba.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../praticas/04_analise-exploratoria-ii.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Análise exploratória de dados - Parte 2</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Análise de dados para o Planejamento Territorial</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial" title="Código fonte" class="quarto-navigation-tool px-1" aria-label="Código fonte"><i class="bi bi-github"></i></a>
    <a href="../analise-de-dados-para-planejamento-territorial.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introdução</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../praticas/01_intro_r_rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução ao R e RStudio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../praticas/02_conceitos-basicos-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Conceitos básicos do R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../praticas/03_analise-exploratoria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Análise exploratória de dados - Parte 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../praticas/04_analise-exploratoria-ii.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Análise exploratória de dados - Parte 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../praticas/05_intervalo-de-confianca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Prática - Intervalo de confiança</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../praticas/06_correlacao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Prática - Correlação</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../praticas/07_regressao-linear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regressão Linear</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../praticas/08_regressao-espacial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Prática - Regressão Espacial</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Apêndices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../apendices/00_erros_frequentes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Erros e <em>warnings</em> frequentes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../apendices/00_sugestao-videos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Sugestão de vídeos, posts, e outros materiais</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#carregando-pacotes" id="toc-carregando-pacotes" class="nav-link active" data-scroll-target="#carregando-pacotes"><span class="header-section-number">4.1</span> Carregando pacotes</a></li>
  <li><a href="#carregando-os-dados" id="toc-carregando-os-dados" class="nav-link" data-scroll-target="#carregando-os-dados"><span class="header-section-number">4.2</span> Carregando os dados</a></li>
  <li><a href="#conhecendo-o-operador-pipe" id="toc-conhecendo-o-operador-pipe" class="nav-link" data-scroll-target="#conhecendo-o-operador-pipe"><span class="header-section-number">4.3</span> Conhecendo o operador pipe (<code>|&gt;</code>)</a></li>
  <li><a href="#principais-funções-do-dplyr" id="toc-principais-funções-do-dplyr" class="nav-link" data-scroll-target="#principais-funções-do-dplyr"><span class="header-section-number">4.4</span> Principais funções do <code>dplyr</code></a></li>
  <li><a href="#filtrando-dados-com-filter" id="toc-filtrando-dados-com-filter" class="nav-link" data-scroll-target="#filtrando-dados-com-filter"><span class="header-section-number">4.5</span> Filtrando dados com <code>filter()</code></a></li>
  <li><a href="#selecionando-colunas-com-select" id="toc-selecionando-colunas-com-select" class="nav-link" data-scroll-target="#selecionando-colunas-com-select"><span class="header-section-number">4.6</span> Selecionando colunas com <code>select()</code></a></li>
  <li><a href="#adicionando-ou-modificando-colunas-com-mutate" id="toc-adicionando-ou-modificando-colunas-com-mutate" class="nav-link" data-scroll-target="#adicionando-ou-modificando-colunas-com-mutate"><span class="header-section-number">4.7</span> Adicionando ou modificando colunas com <code>mutate()</code></a></li>
  <li><a href="#ordenando-dados-com-arrange" id="toc-ordenando-dados-com-arrange" class="nav-link" data-scroll-target="#ordenando-dados-com-arrange"><span class="header-section-number">4.8</span> Ordenando dados com <code>arrange()</code></a></li>
  <li><a href="#agrupando-dados-com-group_by" id="toc-agrupando-dados-com-group_by" class="nav-link" data-scroll-target="#agrupando-dados-com-group_by"><span class="header-section-number">4.9</span> Agrupando dados com <code>group_by()</code></a></li>
  <li><a href="#resumindo-dados-com-summarise" id="toc-resumindo-dados-com-summarise" class="nav-link" data-scroll-target="#resumindo-dados-com-summarise"><span class="header-section-number">4.10</span> Resumindo dados com <code>summarise()</code></a></li>
  <li><a href="#unindo-tabelas-com-left_join" id="toc-unindo-tabelas-com-left_join" class="nav-link" data-scroll-target="#unindo-tabelas-com-left_join"><span class="header-section-number">4.11</span> Unindo tabelas com <code>left_join()</code></a></li>
  <li><a href="#materiais-complementares" id="toc-materiais-complementares" class="nav-link" data-scroll-target="#materiais-complementares"><span class="header-section-number">4.12</span> Materiais complementares</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/edit/main/praticas/04_analise-exploratoria-ii.qmd" class="toc-action"><i class="bi bi-github"></i>Editar essa página</a></li><li><a href="https://github.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/issues/new" class="toc-action"><i class="bi empty"></i>Criar uma issue</a></li><li><a href="https://github.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/blob/main/praticas/04_analise-exploratoria-ii.qmd" class="toc-action"><i class="bi empty"></i>Ver o código fonte</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Análise exploratória de dados - Parte 2</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Docentes</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://sig.ufabc.edu.br/sigaa/public/docente/portal.jsf?siape=2064223">Flávia da Fonseca Feitosa</a> <a href="mailto:flavia.feitosa@ufabc.edu.br" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
             <p><a href="https://www.beamilz.com/">Beatriz Milz</a> <a href="mailto:milz.bea@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>Nesta segunda parte da análise exploratória de dados, vamos conhecer as funções mais importantes do pacote <code>dplyr</code> para manipulação de dados.</p>
<section id="carregando-pacotes" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="carregando-pacotes"><span class="header-section-number">4.1</span> Carregando pacotes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="carregando-os-dados" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="carregando-os-dados"><span class="header-section-number">4.2</span> Carregando os dados</h2>
<p>Vamos continuar trabalhando nos dados da CETESB, que já foram carregados na <a href="../praticas/03_analise-exploratoria.html">primeira parte da análise exploratória (aula passada)</a>. Caso você não tenha feito isso, recomendo que você siga as instruções da aula anterior antes de continuar a aula de hoje.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"dados/dados-cetesb-2022.csv"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 645 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (2): uf, municipio
dbl (10): ano, ugrhi, codigo_ibge, populacao_urbana, atendimento_coleta_porc...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Outra forma de importar os dados é utilizando o link direto do repositório do GitHub onde os dados estão armazenados. Você pode fazer isso utilizando a função <code>read_csv()</code> do pacote <code>readr</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/refs/heads/main/dados/dados-cetesb-2022.csv"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A função <code>glimpse()</code> do pacote <code>dplyr</code>, que conhecemos na aula passada, é uma forma rápida de visualizar a estrutura dos dados. Ela nos mostra o nome das colunas, o tipo de dado de cada coluna e os primeiros valores de cada coluna:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dados_cetesb)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 645
Columns: 12
$ ano                           &lt;dbl&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022…
$ uf                            &lt;chr&gt; "SP", "SP", "SP", "SP", "SP", "SP", "SP"…
$ ugrhi                         &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ municipio                     &lt;chr&gt; "Campos do Jordão", "Santo Antônio do Pi…
$ codigo_ibge                   &lt;dbl&gt; 3509700, 3548203, 3548609, 3502507, 3503…
$ populacao_urbana              &lt;dbl&gt; 52384, 4067, 5251, 35684, 1844, 2619, 88…
$ atendimento_coleta_porc       &lt;dbl&gt; 52.6, 46.7, 98.0, 70.0, 95.6, 100.0, 88.…
$ atendimento_tratamento_porc   &lt;dbl&gt; 100.0, 100.0, 100.0, 0.0, 95.6, 0.0, 100…
$ eficiencia                    &lt;dbl&gt; 93.0, 80.0, 91.3, 0.0, 99.0, 0.0, 75.0, …
$ carga_poluidora_potencial     &lt;dbl&gt; 2829, 220, 284, 1927, 100, 141, 476, 442…
$ carga_poluidora_remancescente &lt;dbl&gt; 1445, 138, 30, 1927, 9, 141, 161, 1858, …
$ ictem                         &lt;dbl&gt; 5.97, 4.63, 9.97, 1.55, 9.86, 1.50, 7.61…</code></pre>
</div>
</div>
</section>
<section id="conhecendo-o-operador-pipe" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="conhecendo-o-operador-pipe"><span class="header-section-number">4.3</span> Conhecendo o operador pipe (<code>|&gt;</code>)</h2>
<p>O operador pipe (<code>|&gt;</code> ou <code>%&gt;%</code>) permite encadear operações de forma mais legível e intuitiva.</p>
<p>Por exemplo, podemos utilizar o operador pipe para aplicar a função <code>glimpse()</code> diretamente nos dados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 645
Columns: 12
$ ano                           &lt;dbl&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022…
$ uf                            &lt;chr&gt; "SP", "SP", "SP", "SP", "SP", "SP", "SP"…
$ ugrhi                         &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ municipio                     &lt;chr&gt; "Campos do Jordão", "Santo Antônio do Pi…
$ codigo_ibge                   &lt;dbl&gt; 3509700, 3548203, 3548609, 3502507, 3503…
$ populacao_urbana              &lt;dbl&gt; 52384, 4067, 5251, 35684, 1844, 2619, 88…
$ atendimento_coleta_porc       &lt;dbl&gt; 52.6, 46.7, 98.0, 70.0, 95.6, 100.0, 88.…
$ atendimento_tratamento_porc   &lt;dbl&gt; 100.0, 100.0, 100.0, 0.0, 95.6, 0.0, 100…
$ eficiencia                    &lt;dbl&gt; 93.0, 80.0, 91.3, 0.0, 99.0, 0.0, 75.0, …
$ carga_poluidora_potencial     &lt;dbl&gt; 2829, 220, 284, 1927, 100, 141, 476, 442…
$ carga_poluidora_remancescente &lt;dbl&gt; 1445, 138, 30, 1927, 9, 141, 161, 1858, …
$ ictem                         &lt;dbl&gt; 5.97, 4.63, 9.97, 1.55, 9.86, 1.50, 7.61…</code></pre>
</div>
</div>
<p>Com apenas uma função, não é tão óbvio o benefício do operador pipe. No entanto, quando começamos a encadear várias funções, ele se torna muito útil. Veremos exemplos disso ao longo desta aula!</p>
</section>
<section id="principais-funções-do-dplyr" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="principais-funções-do-dplyr"><span class="header-section-number">4.4</span> Principais funções do <code>dplyr</code></h2>
<p>O pacote <code>dplyr</code> é uma das ferramentas mais poderosas para manipulação de dados no R. Ele oferece uma série de funções que facilitam a transformação e análise de dados. Vamos conhecer algumas das principais funções do <code>dplyr</code>:</p>
<ul>
<li><p><code>filter()</code>: filtra linhas com base em condições específicas.</p></li>
<li><p><code>select()</code>: seleciona colunas específicas de um data frame.</p></li>
<li><p><code>mutate()</code>: adiciona ou modifica colunas.</p></li>
<li><p><code>arrange()</code>: ordena as linhas de um data frame com base em uma ou mais colunas.</p></li>
<li><p><code>summarise()</code>: resume os dados, calculando estatísticas agregadas.</p></li>
<li><p><code>group_by()</code>: agrupa os dados com base em uma ou mais colunas, permitindo aplicar funções de resumo a cada grupo.</p></li>
</ul>
<p>Ao apresentar essas funções, não vamos abordar todos os casos de uso, mas sim o básico de cada uma delas. Você pode consultar os materiais listados no final da aula para aprender mais sobre cada função e suas possibilidades.</p>
</section>
<section id="filtrando-dados-com-filter" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="filtrando-dados-com-filter"><span class="header-section-number">4.5</span> Filtrando dados com <code>filter()</code></h2>
<p>A A função <code>filter()</code> é utilizada para filtrar linhas de um data frame com base em condições específicas.</p>
<p>Por exemplo, podemos filtrar os dados da CETESB para mostrar apenas os municípios que possuem uma população urbana maior que 1 milhão de habitantes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(populacao_urbana <span class="sc">&gt;</span> <span class="dv">1000000</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 12
    ano uf    ugrhi municipio codigo_ibge populacao_urbana
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;            &lt;dbl&gt;
1  2022 SP        5 Campinas      3509502          1202203
2  2022 SP        6 Guarulhos     3518800          1404694
3  2022 SP        6 São Paulo     3550308         12284940
# ℹ 6 more variables: atendimento_coleta_porc &lt;dbl&gt;,
#   atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Podemos também filtrar as linhas dos municípios do Grande ABC. Neste caso, é mais fácil criar um vetor com os nomes dos municípios, e utilizar o operador <code>%in%</code> para filtrar os dados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>municipios_grande_abc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"São Caetano do Sul"</span>, <span class="st">"São Bernardo do Campo"</span>, <span class="st">"Diadema"</span>, <span class="st">"Santo André"</span>, <span class="st">"Mauá"</span>, <span class="st">"Ribeirão Pires"</span>, <span class="st">"Rio Grande da Serra"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(municipio <span class="sc">%in%</span> municipios_grande_abc)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 12
    ano uf    ugrhi municipio             codigo_ibge populacao_urbana
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                       &lt;dbl&gt;            &lt;dbl&gt;
1  2022 SP        6 Diadema                   3513801           429550
2  2022 SP        6 Mauá                      3529401           481725
3  2022 SP        6 Ribeirão Pires            3543303           125238
4  2022 SP        6 Rio Grande da Serra       3544103            52009
5  2022 SP        6 Santo André               3547809           723889
6  2022 SP        6 São Bernardo do Campo     3548708           835657
7  2022 SP        6 São Caetano do Sul        3548807           162763
# ℹ 6 more variables: atendimento_coleta_porc &lt;dbl&gt;,
#   atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Podemos também consultar quais são os municípios que coletam 100% do esgoto produzido:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(atendimento_coleta_porc <span class="sc">==</span> <span class="dv">100</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 253 × 12
     ano uf    ugrhi municipio          codigo_ibge populacao_urbana
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                    &lt;dbl&gt;            &lt;dbl&gt;
 1  2022 SP        2 Areias                 3503505             2619
 2  2022 SP        2 Caçapava               3508504            81929
 3  2022 SP        2 Cachoeira Paulista     3508603            27623
 4  2022 SP        2 Jambeiro               3524907             3269
 5  2022 SP        2 Pindamonhangaba        3538006           165703
 6  2022 SP        2 Taubaté                3554102           313898
 7  2022 SP        4 Altinópolis            3501004            14172
 8  2022 SP        4 Caconde                3508702            12975
 9  2022 SP        4 Casa Branca            3510807            25075
10  2022 SP        4 Jardinópolis           3525102            43706
# ℹ 243 more rows
# ℹ 6 more variables: atendimento_coleta_porc &lt;dbl&gt;,
#   atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Destes, podemos filtrar os que tratem 100% do esgoto coletado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(atendimento_coleta_porc <span class="sc">==</span> <span class="dv">100</span>, atendimento_tratamento_porc <span class="sc">==</span> <span class="dv">100</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 218 × 12
     ano uf    ugrhi municipio               codigo_ibge populacao_urbana
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                         &lt;dbl&gt;            &lt;dbl&gt;
 1  2022 SP        2 Cachoeira Paulista          3508603            27623
 2  2022 SP        2 Jambeiro                    3524907             3269
 3  2022 SP        2 Pindamonhangaba             3538006           165703
 4  2022 SP        2 Taubaté                     3554102           313898
 5  2022 SP        4 Altinópolis                 3501004            14172
 6  2022 SP        4 Santa Cruz da Esperança     3546256             1467
 7  2022 SP        4 Serrana                     3551504            45677
 8  2022 SP        4 Tambaú                      3553302            20663
 9  2022 SP        5 Corumbataí                  3512704             2200
10  2022 SP        5 Holambra                    3519055            11303
# ℹ 208 more rows
# ℹ 6 more variables: atendimento_coleta_porc &lt;dbl&gt;,
#   atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
<p>As possibilidades são muitas! Podemos combinar várias condições utilizando os operadores lógicos (como o <code>|</code> (OU) e o <code>!</code> (NEGAÇÃO).</p>
</section>
<section id="selecionando-colunas-com-select" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="selecionando-colunas-com-select"><span class="header-section-number">4.6</span> Selecionando colunas com <code>select()</code></h2>
<p>A função <code>select()</code> é utilizada para selecionar colunas específicas de um data frame.</p>
<p>Por exemplo, podemos selecionar apenas as colunas <code>municipio</code>, <code>populacao_urbana</code> e <code>atendimento_coleta_porc</code> dos dados da CETESB:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(municipio, populacao_urbana, atendimento_coleta_porc)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 645 × 3
   municipio               populacao_urbana atendimento_coleta_porc
   &lt;chr&gt;                              &lt;dbl&gt;                   &lt;dbl&gt;
 1 Campos do Jordão                   52384                    52.6
 2 Santo Antônio do Pinhal             4067                    46.7
 3 São Bento do Sapucaí                5251                    98  
 4 Aparecida                          35684                    70  
 5 Arapeí                              1844                    95.6
 6 Areias                              2619                   100  
 7 Bananal                             8808                    88.1
 8 Caçapava                           81929                   100  
 9 Cachoeira Paulista                 27623                   100  
10 Canas                               4890                    84.6
# ℹ 635 more rows</code></pre>
</div>
</div>
<p>Podemos também indicar quais colunas queremos excluir, utilizando o operador <code>-</code> antes do nome da coluna. Por exemplo, para excluir as colunas <code>ano</code> e <code>uf</code>, podemos fazer o seguinte:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ano, <span class="sc">-</span>uf)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 645 × 10
   ugrhi municipio           codigo_ibge populacao_urbana atendimento_coleta_p…¹
   &lt;dbl&gt; &lt;chr&gt;                     &lt;dbl&gt;            &lt;dbl&gt;                  &lt;dbl&gt;
 1     1 Campos do Jordão        3509700            52384                   52.6
 2     1 Santo Antônio do P…     3548203             4067                   46.7
 3     1 São Bento do Sapuc…     3548609             5251                   98  
 4     2 Aparecida               3502507            35684                   70  
 5     2 Arapeí                  3503158             1844                   95.6
 6     2 Areias                  3503505             2619                  100  
 7     2 Bananal                 3504909             8808                   88.1
 8     2 Caçapava                3508504            81929                  100  
 9     2 Cachoeira Paulista      3508603            27623                  100  
10     2 Canas                   3509957             4890                   84.6
# ℹ 635 more rows
# ℹ abbreviated name: ¹​atendimento_coleta_porc
# ℹ 5 more variables: atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="adicionando-ou-modificando-colunas-com-mutate" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="adicionando-ou-modificando-colunas-com-mutate"><span class="header-section-number">4.7</span> Adicionando ou modificando colunas com <code>mutate()</code></h2>
<p>A função <code>mutate()</code> é utilizada para adicionar novas colunas ou modificar colunas existentes em um data frame.</p>
<p>A sintaxe básica da função <code>mutate()</code> é:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>base_de_dados <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nome_da_nova_coluna =</span> o_que_queremos_que_seja_salvo_nela)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por exemplo, podemos criar uma coluna nova chamada <code>populacao_urbana_mil</code> que representa a população urbana em mil habitantes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># selecionando as colunas municipio e populacao_urbana</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># para facilitar a visualização</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(municipio, populacao_urbana) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">populacao_urbana_mil =</span> populacao_urbana <span class="sc">/</span> <span class="dv">1000</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 645 × 3
   municipio               populacao_urbana populacao_urbana_mil
   &lt;chr&gt;                              &lt;dbl&gt;                &lt;dbl&gt;
 1 Campos do Jordão                   52384                52.4 
 2 Santo Antônio do Pinhal             4067                 4.07
 3 São Bento do Sapucaí                5251                 5.25
 4 Aparecida                          35684                35.7 
 5 Arapeí                              1844                 1.84
 6 Areias                              2619                 2.62
 7 Bananal                             8808                 8.81
 8 Caçapava                           81929                81.9 
 9 Cachoeira Paulista                 27623                27.6 
10 Canas                               4890                 4.89
# ℹ 635 more rows</code></pre>
</div>
</div>
<p>A função <code>mutate()</code> também pode ser utilizada para modificar colunas existentes. Por exemplo, podemos mudar a classe de algumas colunas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ugrhi =</span> <span class="fu">as.character</span>(ugrhi),  <span class="co"># convertendo ugrhi para character</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">codigo_ibge =</span> <span class="fu">as.character</span>(codigo_ibge)  <span class="co"># convertendo codigo_ibge para character</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 645 × 12
     ano uf    ugrhi municipio               codigo_ibge populacao_urbana
   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                   &lt;chr&gt;                  &lt;dbl&gt;
 1  2022 SP    1     Campos do Jordão        3509700                52384
 2  2022 SP    1     Santo Antônio do Pinhal 3548203                 4067
 3  2022 SP    1     São Bento do Sapucaí    3548609                 5251
 4  2022 SP    2     Aparecida               3502507                35684
 5  2022 SP    2     Arapeí                  3503158                 1844
 6  2022 SP    2     Areias                  3503505                 2619
 7  2022 SP    2     Bananal                 3504909                 8808
 8  2022 SP    2     Caçapava                3508504                81929
 9  2022 SP    2     Cachoeira Paulista      3508603                27623
10  2022 SP    2     Canas                   3509957                 4890
# ℹ 635 more rows
# ℹ 6 more variables: atendimento_coleta_porc &lt;dbl&gt;,
#   atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="ordenando-dados-com-arrange" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="ordenando-dados-com-arrange"><span class="header-section-number">4.8</span> Ordenando dados com <code>arrange()</code></h2>
<p>A função <code>arrange()</code> é utilizada para ordenar as linhas de um data frame com base em uma ou mais colunas.</p>
<p>Podemos ordenar os dados da CETESB pela coluna <code>carga_poluidora_remancescente</code>, em ordem crescente:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(carga_poluidora_remancescente)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 645 × 12
     ano uf    ugrhi municipio              codigo_ibge populacao_urbana
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                        &lt;dbl&gt;            &lt;dbl&gt;
 1  2022 SP       14 Ribeirão Grande            3543253             2427
 2  2022 SP       13 Trabiju                    3554755             1609
 3  2022 SP       21 Borá                       3507209              653
 4  2022 SP       15 Turmalina                  3555307             1186
 5  2022 SP        2 Jambeiro                   3524907             3269
 6  2022 SP       18 Santa Salete               3547650              882
 7  2022 SP       18 Santana da Ponte Pensa     3547205              968
 8  2022 SP       15 Mesópolis                  3529658             1481
 9  2022 SP       18 Nova Canaã Paulista        3532843              759
10  2022 SP       19 Turiúba                    3555208             1657
# ℹ 635 more rows
# ℹ 6 more variables: atendimento_coleta_porc &lt;dbl&gt;,
#   atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Também podemos ordenar os dados em ordem decrescente, utilizando a função <code>desc()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(populacao_urbana))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 645 × 12
     ano uf    ugrhi municipio             codigo_ibge populacao_urbana
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                       &lt;dbl&gt;            &lt;dbl&gt;
 1  2022 SP        6 São Paulo                 3550308         12284940
 2  2022 SP        6 Guarulhos                 3518800          1404694
 3  2022 SP        5 Campinas                  3509502          1202203
 4  2022 SP        6 São Bernardo do Campo     3548708           835657
 5  2022 SP        6 Santo André               3547809           723889
 6  2022 SP        2 São José dos Campos       3549904           722310
 7  2022 SP        4 Ribeirão Preto            3543402           718072
 8  2022 SP        6 Osasco                    3534401           701428
 9  2022 SP       10 Sorocaba                  3552205           688252
10  2022 SP        6 Mauá                      3529401           481725
# ℹ 635 more rows
# ℹ 6 more variables: atendimento_coleta_porc &lt;dbl&gt;,
#   atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="agrupando-dados-com-group_by" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="agrupando-dados-com-group_by"><span class="header-section-number">4.9</span> Agrupando dados com <code>group_by()</code></h2>
<p>A função <code>group_by()</code> é utilizada para agrupar os dados com base em uma ou mais colunas. Isso é especialmente útil quando queremos aplicar funções de resumo a cada grupo.</p>
<p>Por exemplo, podemos agrupar os dados da CETESB pela coluna <code>ugrhi</code> (Unidade de Gerenciamento de Recursos Hídricos) e calcular a soma da população urbana para cada UGRHI:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ugrhi) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 645 × 12
# Groups:   ugrhi [22]
     ano uf    ugrhi municipio               codigo_ibge populacao_urbana
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;                         &lt;dbl&gt;            &lt;dbl&gt;
 1  2022 SP        1 Campos do Jordão            3509700            52384
 2  2022 SP        1 Santo Antônio do Pinhal     3548203             4067
 3  2022 SP        1 São Bento do Sapucaí        3548609             5251
 4  2022 SP        2 Aparecida                   3502507            35684
 5  2022 SP        2 Arapeí                      3503158             1844
 6  2022 SP        2 Areias                      3503505             2619
 7  2022 SP        2 Bananal                     3504909             8808
 8  2022 SP        2 Caçapava                    3508504            81929
 9  2022 SP        2 Cachoeira Paulista          3508603            27623
10  2022 SP        2 Canas                       3509957             4890
# ℹ 635 more rows
# ℹ 6 more variables: atendimento_coleta_porc &lt;dbl&gt;,
#   atendimento_tratamento_porc &lt;dbl&gt;, eficiencia &lt;dbl&gt;,
#   carga_poluidora_potencial &lt;dbl&gt;, carga_poluidora_remancescente &lt;dbl&gt;,
#   ictem &lt;dbl&gt;</code></pre>
</div>
</div>
<p>A função <code>group_by()</code> não altera os dados, mas prepara o data frame para que possamos aplicar funções de resumo a cada grupo. Portanto, ela é frequentemente utilizada em conjunto com a função <code>summarise()</code>.</p>
</section>
<section id="resumindo-dados-com-summarise" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="resumindo-dados-com-summarise"><span class="header-section-number">4.10</span> Resumindo dados com <code>summarise()</code></h2>
<p>A função <code>summarise()</code> é utilizada para resumir os dados, calculando estatísticas agregadas. Ela é frequentemente utilizada em conjunto com a função <code>group_by()</code>.</p>
<p>Como vimos na aula anterior, a função <code>summary()</code> nos dá um resumo de estatísticas descritivas para todas as colunas. Porém, podemos querer calcular estatísticas descritivas apenas para algum subconjunto dos dados.</p>
<p>Imagine que queremos calcular algumas estatísticas descritivas considerando cada UGRHI (Unidade de Gerenciamento de Recursos Hídricos) separadamente. Podemos fazer isso utilizando as funções <code>group_by()</code> e <code>summarise()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>estatisticas_descritivas <span class="ot">&lt;-</span> dados_cetesb <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># agrupar os dados pela coluna ugrhi</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ugrhi) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calcular estatísticas descritivas para cada grupo</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantidade_municipios =</span> <span class="fu">n</span>(),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">soma_populacao_urbana =</span> <span class="fu">sum</span>(populacao_urbana),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_ictem =</span> <span class="fu">mean</span>(ictem) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mediana_ictem =</span> <span class="fu">median</span>(ictem) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">desvio_padrao_ictem =</span> <span class="fu">sd</span>(ictem) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(estatisticas_descritivas)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">ugrhi</th>
<th style="text-align: right;">quantidade_municipios</th>
<th style="text-align: right;">soma_populacao_urbana</th>
<th style="text-align: right;">media_ictem</th>
<th style="text-align: right;">mediana_ictem</th>
<th style="text-align: right;">desvio_padrao_ictem</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">61702</td>
<td style="text-align: right;">6.86</td>
<td style="text-align: right;">5.97</td>
<td style="text-align: right;">2.78</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2124413</td>
<td style="text-align: right;">5.87</td>
<td style="text-align: right;">6.98</td>
<td style="text-align: right;">3.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">337159</td>
<td style="text-align: right;">5.10</td>
<td style="text-align: right;">4.66</td>
<td style="text-align: right;">1.74</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">1215586</td>
<td style="text-align: right;">7.09</td>
<td style="text-align: right;">8.12</td>
<td style="text-align: right;">2.83</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">5737151</td>
<td style="text-align: right;">7.10</td>
<td style="text-align: right;">7.85</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">21626154</td>
<td style="text-align: right;">4.93</td>
<td style="text-align: right;">5.03</td>
<td style="text-align: right;">2.39</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1893370</td>
<td style="text-align: right;">5.01</td>
<td style="text-align: right;">5.09</td>
<td style="text-align: right;">1.22</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">707923</td>
<td style="text-align: right;">9.18</td>
<td style="text-align: right;">9.98</td>
<td style="text-align: right;">1.34</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">1542781</td>
<td style="text-align: right;">6.91</td>
<td style="text-align: right;">7.64</td>
<td style="text-align: right;">3.02</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">1937230</td>
<td style="text-align: right;">7.05</td>
<td style="text-align: right;">7.10</td>
<td style="text-align: right;">2.66</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">273446</td>
<td style="text-align: right;">7.10</td>
<td style="text-align: right;">7.09</td>
<td style="text-align: right;">1.87</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">346186</td>
<td style="text-align: right;">7.92</td>
<td style="text-align: right;">8.45</td>
<td style="text-align: right;">2.59</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">1608773</td>
<td style="text-align: right;">7.94</td>
<td style="text-align: right;">8.08</td>
<td style="text-align: right;">2.29</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">631467</td>
<td style="text-align: right;">8.01</td>
<td style="text-align: right;">8.20</td>
<td style="text-align: right;">1.84</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">1289129</td>
<td style="text-align: right;">8.77</td>
<td style="text-align: right;">9.89</td>
<td style="text-align: right;">1.66</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">520262</td>
<td style="text-align: right;">8.36</td>
<td style="text-align: right;">9.70</td>
<td style="text-align: right;">2.24</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">666615</td>
<td style="text-align: right;">8.88</td>
<td style="text-align: right;">9.75</td>
<td style="text-align: right;">1.23</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">212661</td>
<td style="text-align: right;">9.01</td>
<td style="text-align: right;">10.00</td>
<td style="text-align: right;">1.63</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">772089</td>
<td style="text-align: right;">8.31</td>
<td style="text-align: right;">8.15</td>
<td style="text-align: right;">1.54</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">348271</td>
<td style="text-align: right;">8.69</td>
<td style="text-align: right;">8.57</td>
<td style="text-align: right;">1.34</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">444578</td>
<td style="text-align: right;">8.96</td>
<td style="text-align: right;">9.70</td>
<td style="text-align: right;">1.80</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">470161</td>
<td style="text-align: right;">9.09</td>
<td style="text-align: right;">9.70</td>
<td style="text-align: right;">1.01</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Podemos salvar o resultado em um arquivo CSV ou Excel, utilizando as funções <code>readr::write_csv()</code> ou <code>writexl::write_excel_csv()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(estatisticas_descritivas,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">"dados/estatisticas-descritivas-ugrhi.csv"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(estatisticas_descritivas,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"dados/estatisticas-descritivas-ugrhi.xlsx"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="unindo-tabelas-com-left_join" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="unindo-tabelas-com-left_join"><span class="header-section-number">4.11</span> Unindo tabelas com <code>left_join()</code></h2>
<p>A função <code>left_join()</code> é utilizada para unir duas tabelas com base em uma ou mais colunas em comum (chamada de chave - <code>key</code>).</p>
<p>Para este exemplo, vamos importar <a href="https://raw.githubusercontent.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/refs/heads/main/praticas/dados/idhm_sp_2010.csv">uma tabela</a> que contém informações sobre o IDH (Índice de Desenvolvimento Humano) dos municípios de São Paulo, referente ao ano de 2010. Esses dados são baseados no Censo, mas ainda não temos o IDH calculado para o ano de 2022.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dados_idhm <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/refs/heads/main/praticas/dados/idhm_sp_2010.csv"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 645 Columns: 15
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (3): muni_nm, uf_sigla, regiao_nm
dbl (12): ano, muni_id, idhm, idhm_e, idhm_l, idhm_r, espvida, rdpc, gini, p...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Para fazer o join, precisamos garantir que as colunas que vamos utilizar como chave estejam no mesmo formato. Neste caso, vamos utilizar a coluna referente ao código do IBGE como chave para unir as duas tabelas:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dados_idhm)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ano"       "muni_id"   "muni_nm"   "uf_sigla"  "regiao_nm" "idhm"     
 [7] "idhm_e"    "idhm_l"    "idhm_r"    "espvida"   "rdpc"      "gini"     
[13] "pop"       "lat"       "lon"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dados_cetesb)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ano"                           "uf"                           
 [3] "ugrhi"                         "municipio"                    
 [5] "codigo_ibge"                   "populacao_urbana"             
 [7] "atendimento_coleta_porc"       "atendimento_tratamento_porc"  
 [9] "eficiencia"                    "carga_poluidora_potencial"    
[11] "carga_poluidora_remancescente" "ictem"                        </code></pre>
</div>
</div>
<p>É importante que a variável que usaremos como chave esteja no mesmo formato nas duas tabelas. Usamos a função <code>class()</code> para verificar o tipo de dado de cada coluna:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dados_cetesb<span class="sc">$</span>codigo_ibge)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dados_idhm<span class="sc">$</span>muni_id)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>Obs: caso as colunas não estejam no mesmo formato, podemos utilizar a função <code>mutate()</code> para alterar o tipo de dado de uma das colunas, junto com funções como <code>as.character()</code> ou <code>as.numeric()</code>, dependendo da classe de dado que queremos.</p>
<p>Agora podemos unir as duas tabelas utilizando a função <code>left_join()</code>. Essa função irá manter todas as linhas da tabela da esquerda (<code>dados_cetesb</code>) e adicionar as colunas da tabela da direita (<code>dados_idhm</code>) onde houver correspondência na chave especificada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dados_unidos <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tabela da esquerda</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  dados_cetesb, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tabela da direita</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  dados_idhm, </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># o argumento `by` especifica as colunas que serão utilizadas como chave para o join</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"codigo_ibge"</span> <span class="ot">=</span> <span class="st">"muni_id"</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A nova tabela <code>dados_unidos</code> agora contém todas as colunas de ambas as tabelas, com os dados do IDH adicionados aos municípios correspondentes. Se um município não tiver um valor correspondente na tabela de IDH, as colunas relacionadas ao IDH terão valores <code>NA</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dados_unidos)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 645
Columns: 26
$ ano.x                         &lt;dbl&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022…
$ uf                            &lt;chr&gt; "SP", "SP", "SP", "SP", "SP", "SP", "SP"…
$ ugrhi                         &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ municipio                     &lt;chr&gt; "Campos do Jordão", "Santo Antônio do Pi…
$ codigo_ibge                   &lt;dbl&gt; 3509700, 3548203, 3548609, 3502507, 3503…
$ populacao_urbana              &lt;dbl&gt; 52384, 4067, 5251, 35684, 1844, 2619, 88…
$ atendimento_coleta_porc       &lt;dbl&gt; 52.6, 46.7, 98.0, 70.0, 95.6, 100.0, 88.…
$ atendimento_tratamento_porc   &lt;dbl&gt; 100.0, 100.0, 100.0, 0.0, 95.6, 0.0, 100…
$ eficiencia                    &lt;dbl&gt; 93.0, 80.0, 91.3, 0.0, 99.0, 0.0, 75.0, …
$ carga_poluidora_potencial     &lt;dbl&gt; 2829, 220, 284, 1927, 100, 141, 476, 442…
$ carga_poluidora_remancescente &lt;dbl&gt; 1445, 138, 30, 1927, 9, 141, 161, 1858, …
$ ictem                         &lt;dbl&gt; 5.97, 4.63, 9.97, 1.55, 9.86, 1.50, 7.61…
$ ano.y                         &lt;dbl&gt; 2010, 2010, 2010, 2010, 2010, 2010, 2010…
$ muni_nm                       &lt;chr&gt; "CAMPOS DO JORDÃO", "SANTO ANTÔNIO DO PI…
$ uf_sigla                      &lt;chr&gt; "SP", "SP", "SP", "SP", "SP", "SP", "SP"…
$ regiao_nm                     &lt;chr&gt; "Sudeste", "Sudeste", "Sudeste", "Sudest…
$ idhm                          &lt;dbl&gt; 0.749, 0.706, 0.720, 0.755, 0.680, 0.697…
$ idhm_e                        &lt;dbl&gt; 0.648, 0.632, 0.638, 0.706, 0.612, 0.672…
$ idhm_l                        &lt;dbl&gt; 0.852, 0.812, 0.812, 0.828, 0.812, 0.803…
$ idhm_r                        &lt;dbl&gt; 0.761, 0.685, 0.719, 0.735, 0.634, 0.627…
$ espvida                       &lt;dbl&gt; 76.10, 73.69, 73.69, 74.67, 73.72, 73.18…
$ rdpc                          &lt;dbl&gt; 911.40, 569.08, 701.89, 775.17, 414.19, …
$ gini                          &lt;dbl&gt; 0.59, 0.47, 0.55, 0.46, 0.39, 0.44, 0.51…
$ pop                           &lt;dbl&gt; 47287, 6450, 10370, 34630, 2481, 3632, 1…
$ lat                           &lt;dbl&gt; -22.739, -22.827, -22.689, -22.847, -22.…
$ lon                           &lt;dbl&gt; -45.591, -45.663, -45.731, -45.230, -44.…</code></pre>
</div>
</div>
<p>Podemos salvar os dados unidos em um arquivo CSV ou Excel, utilizando as funções <code>readr::write_csv()</code> ou <code>writexl::write_excel_csv()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(dados_unidos,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">"dados/dados-join-cetesb-idhm.csv"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este caso é um exemplo de um join bem simples, onde temos uma chave única em cada tabela. No entanto, existem outros tipos de joins, como <code>inner_join()</code>, <code>right_join()</code>, <code>full_join()</code>, que podem ser utilizados dependendo da situação.</p>
</section>
<section id="materiais-complementares" class="level2" data-number="4.12">
<h2 data-number="4.12" class="anchored" data-anchor-id="materiais-complementares"><span class="header-section-number">4.12</span> Materiais complementares</h2>
<ul>
<li>Materiais do curso <a href="https://ipeadata-lab.github.io/curso_r_intro_202409/">Introdução à análise de dados no R</a>:
<ul>
<li><a href="https://ipeadata-lab.github.io/curso_r_intro_202409/05_transformacao.html">Transformando dados</a></li>
<li><a href="https://ipeadata-lab.github.io/curso_r_intro_202409/06_analise_exploratoria.html">Análise exploratória de dados</a></li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiada");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiada");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/beatrizmilz\.github\.io\/ESHT011-21-analise-dados-planejamento-territorial\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../praticas/03_analise-exploratoria.html" class="pagination-link" aria-label="Análise exploratória de dados - Parte 1">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Análise exploratória de dados - Parte 1</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../praticas/05_intervalo-de-confianca.html" class="pagination-link" aria-label="Prática - Intervalo de confiança">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Prática - Intervalo de confiança</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/edit/main/praticas/04_analise-exploratoria-ii.qmd" class="toc-action"><i class="bi bi-github"></i>Editar essa página</a></li><li><a href="https://github.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/issues/new" class="toc-action"><i class="bi empty"></i>Criar uma issue</a></li><li><a href="https://github.com/beatrizmilz/ESHT011-21-analise-dados-planejamento-territorial/blob/main/praticas/04_analise-exploratoria-ii.qmd" class="toc-action"><i class="bi empty"></i>Ver o código fonte</a></li></ul></div></div></div></footer></body></html>